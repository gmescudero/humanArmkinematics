#define IMU_MAX_NUMBER (1)

static void simu_state_estimate(double T, double g_x, double g_y, double g_z, double h_x, double h_y, double h_z, double omega_x, double omega_y, double omega_z, double *out_8794888771751233999) {
   out_8794888771751233999[0] = -T*g_y*omega_z + T*g_z*omega_y + g_x;
   out_8794888771751233999[1] = T*g_x*omega_z - T*g_z*omega_x + g_y;
   out_8794888771751233999[2] = -T*g_x*omega_y + T*g_y*omega_x + g_z;
   out_8794888771751233999[3] = -T*h_y*omega_z + T*h_z*omega_y + h_x;
   out_8794888771751233999[4] = T*h_x*omega_z - T*h_z*omega_x + h_y;
   out_8794888771751233999[5] = -T*h_x*omega_y + T*h_y*omega_x + h_z;
}

static void simu_covariance_estimate(double T, double *P_k_k, double *Q, double omega_x, double omega_y, double omega_z, double *P_kp1_k) {
   P_kp1_k[0] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[12] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[6] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[30] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[24] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[0] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[18];
   P_kp1_k[1] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[13] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[7] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[31] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[25] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[1] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[19];
   P_kp1_k[2] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[14] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[8] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[32] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[26] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[2] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[20];
   P_kp1_k[3] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[15] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[9] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[33] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[27] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[3] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[21];
   P_kp1_k[4] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[16] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[10] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[34] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[28] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[4] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[22];
   P_kp1_k[5] = (T*omega_x*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]) - T*omega_y*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[17] + (-T*omega_x*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) + T*omega_z*(T*omega_y*P_k_k[12] - T*omega_z*P_k_k[6]))*Q[11] + (T*omega_x*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]) - T*omega_y*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[35] + (-T*omega_x*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) + T*omega_z*(T*omega_y*P_k_k[15] - T*omega_z*P_k_k[9]))*Q[29] + (T*omega_y*(T*omega_y*P_k_k[14] - T*omega_z*P_k_k[8]) - T*omega_z*(T*omega_y*P_k_k[13] - T*omega_z*P_k_k[7]))*Q[5] + (T*omega_y*(T*omega_y*P_k_k[17] - T*omega_z*P_k_k[11]) - T*omega_z*(T*omega_y*P_k_k[16] - T*omega_z*P_k_k[10]))*Q[23];
   P_kp1_k[6] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[12] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[6] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[30] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[24] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[0] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[18];
   P_kp1_k[7] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[13] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[7] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[31] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[25] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[1] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[19];
   P_kp1_k[8] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[14] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[8] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[32] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[26] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[2] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[20];
   P_kp1_k[9] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[15] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[9] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[33] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[27] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[3] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[21];
   P_kp1_k[10] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[16] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[10] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[34] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[28] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[4] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[22];
   P_kp1_k[11] = (T*omega_x*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]) - T*omega_y*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[17] + (-T*omega_x*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) + T*omega_z*(-T*omega_x*P_k_k[12] + T*omega_z*P_k_k[0]))*Q[11] + (T*omega_x*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]) - T*omega_y*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[35] + (-T*omega_x*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) + T*omega_z*(-T*omega_x*P_k_k[15] + T*omega_z*P_k_k[3]))*Q[29] + (T*omega_y*(-T*omega_x*P_k_k[14] + T*omega_z*P_k_k[2]) - T*omega_z*(-T*omega_x*P_k_k[13] + T*omega_z*P_k_k[1]))*Q[5] + (T*omega_y*(-T*omega_x*P_k_k[17] + T*omega_z*P_k_k[5]) - T*omega_z*(-T*omega_x*P_k_k[16] + T*omega_z*P_k_k[4]))*Q[23];
   P_kp1_k[12] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[12] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[6] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[30] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[24] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[0] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[18];
   P_kp1_k[13] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[13] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[7] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[31] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[25] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[1] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[19];
   P_kp1_k[14] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[14] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[8] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[32] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[26] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[2] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[20];
   P_kp1_k[15] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[15] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[9] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[33] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[27] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[3] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[21];
   P_kp1_k[16] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[16] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[10] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[34] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[28] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[4] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[22];
   P_kp1_k[17] = (T*omega_x*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]) - T*omega_y*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[17] + (-T*omega_x*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) + T*omega_z*(T*omega_x*P_k_k[6] - T*omega_y*P_k_k[0]))*Q[11] + (T*omega_x*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]) - T*omega_y*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[35] + (-T*omega_x*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) + T*omega_z*(T*omega_x*P_k_k[9] - T*omega_y*P_k_k[3]))*Q[29] + (T*omega_y*(T*omega_x*P_k_k[8] - T*omega_y*P_k_k[2]) - T*omega_z*(T*omega_x*P_k_k[7] - T*omega_y*P_k_k[1]))*Q[5] + (T*omega_y*(T*omega_x*P_k_k[11] - T*omega_y*P_k_k[5]) - T*omega_z*(T*omega_x*P_k_k[10] - T*omega_y*P_k_k[4]))*Q[23];
   P_kp1_k[18] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[12] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[6] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[30] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[24] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[0] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[18];
   P_kp1_k[19] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[13] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[7] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[31] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[25] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[1] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[19];
   P_kp1_k[20] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[14] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[8] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[32] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[26] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[2] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[20];
   P_kp1_k[21] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[15] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[9] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[33] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[27] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[3] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[21];
   P_kp1_k[22] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[16] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[10] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[34] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[28] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[4] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[22];
   P_kp1_k[23] = (T*omega_x*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]) - T*omega_y*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[17] + (-T*omega_x*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) + T*omega_z*(T*omega_y*P_k_k[30] - T*omega_z*P_k_k[24]))*Q[11] + (T*omega_x*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]) - T*omega_y*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[35] + (-T*omega_x*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) + T*omega_z*(T*omega_y*P_k_k[33] - T*omega_z*P_k_k[27]))*Q[29] + (T*omega_y*(T*omega_y*P_k_k[32] - T*omega_z*P_k_k[26]) - T*omega_z*(T*omega_y*P_k_k[31] - T*omega_z*P_k_k[25]))*Q[5] + (T*omega_y*(T*omega_y*P_k_k[35] - T*omega_z*P_k_k[29]) - T*omega_z*(T*omega_y*P_k_k[34] - T*omega_z*P_k_k[28]))*Q[23];
   P_kp1_k[24] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[12] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[6] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[30] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[24] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[0] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[18];
   P_kp1_k[25] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[13] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[7] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[31] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[25] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[1] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[19];
   P_kp1_k[26] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[14] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[8] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[32] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[26] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[2] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[20];
   P_kp1_k[27] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[15] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[9] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[33] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[27] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[3] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[21];
   P_kp1_k[28] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[16] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[10] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[34] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[28] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[4] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[22];
   P_kp1_k[29] = (T*omega_x*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]) - T*omega_y*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[17] + (-T*omega_x*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) + T*omega_z*(-T*omega_x*P_k_k[30] + T*omega_z*P_k_k[18]))*Q[11] + (T*omega_x*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]) - T*omega_y*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[35] + (-T*omega_x*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) + T*omega_z*(-T*omega_x*P_k_k[33] + T*omega_z*P_k_k[21]))*Q[29] + (T*omega_y*(-T*omega_x*P_k_k[32] + T*omega_z*P_k_k[20]) - T*omega_z*(-T*omega_x*P_k_k[31] + T*omega_z*P_k_k[19]))*Q[5] + (T*omega_y*(-T*omega_x*P_k_k[35] + T*omega_z*P_k_k[23]) - T*omega_z*(-T*omega_x*P_k_k[34] + T*omega_z*P_k_k[22]))*Q[23];
   P_kp1_k[30] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[12] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[6] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[30] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[24] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[0] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[18];
   P_kp1_k[31] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[13] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[7] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[31] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[25] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[1] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[19];
   P_kp1_k[32] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[14] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[8] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[32] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[26] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[2] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[20];
   P_kp1_k[33] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[15] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[9] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[33] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[27] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[3] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[21];
   P_kp1_k[34] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[16] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[10] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[34] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[28] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[4] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[22];
   P_kp1_k[35] = (T*omega_x*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]) - T*omega_y*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[17] + (-T*omega_x*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) + T*omega_z*(T*omega_x*P_k_k[24] - T*omega_y*P_k_k[18]))*Q[11] + (T*omega_x*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]) - T*omega_y*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[35] + (-T*omega_x*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) + T*omega_z*(T*omega_x*P_k_k[27] - T*omega_y*P_k_k[21]))*Q[29] + (T*omega_y*(T*omega_x*P_k_k[26] - T*omega_y*P_k_k[20]) - T*omega_z*(T*omega_x*P_k_k[25] - T*omega_y*P_k_k[19]))*Q[5] + (T*omega_y*(T*omega_x*P_k_k[29] - T*omega_y*P_k_k[23]) - T*omega_z*(T*omega_x*P_k_k[28] - T*omega_y*P_k_k[22]))*Q[23];
}

static void simu_state_corrected(double *P_kp1_k, double *S_inv, double *x_kp1_k, double *z_k, double *x_kp1_kp1) {
   x_kp1_kp1[0] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[0]*S_inv[0] + P_kp1_k[1]*S_inv[6] + P_kp1_k[2]*S_inv[12] + P_kp1_k[3]*S_inv[18] + P_kp1_k[4]*S_inv[24] + P_kp1_k[5]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[0]*S_inv[1] + P_kp1_k[1]*S_inv[7] + P_kp1_k[2]*S_inv[13] + P_kp1_k[3]*S_inv[19] + P_kp1_k[4]*S_inv[25] + P_kp1_k[5]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[0]*S_inv[2] + P_kp1_k[1]*S_inv[8] + P_kp1_k[2]*S_inv[14] + P_kp1_k[3]*S_inv[20] + P_kp1_k[4]*S_inv[26] + P_kp1_k[5]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[0]*S_inv[3] + P_kp1_k[1]*S_inv[9] + P_kp1_k[2]*S_inv[15] + P_kp1_k[3]*S_inv[21] + P_kp1_k[4]*S_inv[27] + P_kp1_k[5]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[0]*S_inv[4] + P_kp1_k[1]*S_inv[10] + P_kp1_k[2]*S_inv[16] + P_kp1_k[3]*S_inv[22] + P_kp1_k[4]*S_inv[28] + P_kp1_k[5]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[0]*S_inv[5] + P_kp1_k[1]*S_inv[11] + P_kp1_k[2]*S_inv[17] + P_kp1_k[3]*S_inv[23] + P_kp1_k[4]*S_inv[29] + P_kp1_k[5]*S_inv[35]) + x_kp1_k[0];
   x_kp1_kp1[1] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[6]*S_inv[0] + P_kp1_k[7]*S_inv[6] + P_kp1_k[8]*S_inv[12] + P_kp1_k[9]*S_inv[18] + P_kp1_k[10]*S_inv[24] + P_kp1_k[11]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[6]*S_inv[1] + P_kp1_k[7]*S_inv[7] + P_kp1_k[8]*S_inv[13] + P_kp1_k[9]*S_inv[19] + P_kp1_k[10]*S_inv[25] + P_kp1_k[11]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[6]*S_inv[2] + P_kp1_k[7]*S_inv[8] + P_kp1_k[8]*S_inv[14] + P_kp1_k[9]*S_inv[20] + P_kp1_k[10]*S_inv[26] + P_kp1_k[11]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[6]*S_inv[3] + P_kp1_k[7]*S_inv[9] + P_kp1_k[8]*S_inv[15] + P_kp1_k[9]*S_inv[21] + P_kp1_k[10]*S_inv[27] + P_kp1_k[11]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[6]*S_inv[4] + P_kp1_k[7]*S_inv[10] + P_kp1_k[8]*S_inv[16] + P_kp1_k[9]*S_inv[22] + P_kp1_k[10]*S_inv[28] + P_kp1_k[11]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[6]*S_inv[5] + P_kp1_k[7]*S_inv[11] + P_kp1_k[8]*S_inv[17] + P_kp1_k[9]*S_inv[23] + P_kp1_k[10]*S_inv[29] + P_kp1_k[11]*S_inv[35]) + x_kp1_k[1];
   x_kp1_kp1[2] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[12]*S_inv[0] + P_kp1_k[13]*S_inv[6] + P_kp1_k[14]*S_inv[12] + P_kp1_k[15]*S_inv[18] + P_kp1_k[16]*S_inv[24] + P_kp1_k[17]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[12]*S_inv[1] + P_kp1_k[13]*S_inv[7] + P_kp1_k[14]*S_inv[13] + P_kp1_k[15]*S_inv[19] + P_kp1_k[16]*S_inv[25] + P_kp1_k[17]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[12]*S_inv[2] + P_kp1_k[13]*S_inv[8] + P_kp1_k[14]*S_inv[14] + P_kp1_k[15]*S_inv[20] + P_kp1_k[16]*S_inv[26] + P_kp1_k[17]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[12]*S_inv[3] + P_kp1_k[13]*S_inv[9] + P_kp1_k[14]*S_inv[15] + P_kp1_k[15]*S_inv[21] + P_kp1_k[16]*S_inv[27] + P_kp1_k[17]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[12]*S_inv[4] + P_kp1_k[13]*S_inv[10] + P_kp1_k[14]*S_inv[16] + P_kp1_k[15]*S_inv[22] + P_kp1_k[16]*S_inv[28] + P_kp1_k[17]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[12]*S_inv[5] + P_kp1_k[13]*S_inv[11] + P_kp1_k[14]*S_inv[17] + P_kp1_k[15]*S_inv[23] + P_kp1_k[16]*S_inv[29] + P_kp1_k[17]*S_inv[35]) + x_kp1_k[2];
   x_kp1_kp1[3] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[18]*S_inv[0] + P_kp1_k[19]*S_inv[6] + P_kp1_k[20]*S_inv[12] + P_kp1_k[21]*S_inv[18] + P_kp1_k[22]*S_inv[24] + P_kp1_k[23]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[18]*S_inv[1] + P_kp1_k[19]*S_inv[7] + P_kp1_k[20]*S_inv[13] + P_kp1_k[21]*S_inv[19] + P_kp1_k[22]*S_inv[25] + P_kp1_k[23]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[18]*S_inv[2] + P_kp1_k[19]*S_inv[8] + P_kp1_k[20]*S_inv[14] + P_kp1_k[21]*S_inv[20] + P_kp1_k[22]*S_inv[26] + P_kp1_k[23]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[18]*S_inv[3] + P_kp1_k[19]*S_inv[9] + P_kp1_k[20]*S_inv[15] + P_kp1_k[21]*S_inv[21] + P_kp1_k[22]*S_inv[27] + P_kp1_k[23]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[18]*S_inv[4] + P_kp1_k[19]*S_inv[10] + P_kp1_k[20]*S_inv[16] + P_kp1_k[21]*S_inv[22] + P_kp1_k[22]*S_inv[28] + P_kp1_k[23]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[18]*S_inv[5] + P_kp1_k[19]*S_inv[11] + P_kp1_k[20]*S_inv[17] + P_kp1_k[21]*S_inv[23] + P_kp1_k[22]*S_inv[29] + P_kp1_k[23]*S_inv[35]) + x_kp1_k[3];
   x_kp1_kp1[4] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[24]*S_inv[0] + P_kp1_k[25]*S_inv[6] + P_kp1_k[26]*S_inv[12] + P_kp1_k[27]*S_inv[18] + P_kp1_k[28]*S_inv[24] + P_kp1_k[29]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[24]*S_inv[1] + P_kp1_k[25]*S_inv[7] + P_kp1_k[26]*S_inv[13] + P_kp1_k[27]*S_inv[19] + P_kp1_k[28]*S_inv[25] + P_kp1_k[29]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[24]*S_inv[2] + P_kp1_k[25]*S_inv[8] + P_kp1_k[26]*S_inv[14] + P_kp1_k[27]*S_inv[20] + P_kp1_k[28]*S_inv[26] + P_kp1_k[29]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[24]*S_inv[3] + P_kp1_k[25]*S_inv[9] + P_kp1_k[26]*S_inv[15] + P_kp1_k[27]*S_inv[21] + P_kp1_k[28]*S_inv[27] + P_kp1_k[29]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[24]*S_inv[4] + P_kp1_k[25]*S_inv[10] + P_kp1_k[26]*S_inv[16] + P_kp1_k[27]*S_inv[22] + P_kp1_k[28]*S_inv[28] + P_kp1_k[29]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[24]*S_inv[5] + P_kp1_k[25]*S_inv[11] + P_kp1_k[26]*S_inv[17] + P_kp1_k[27]*S_inv[23] + P_kp1_k[28]*S_inv[29] + P_kp1_k[29]*S_inv[35]) + x_kp1_k[4];
   x_kp1_kp1[5] = (-x_kp1_k[0] + z_k[0])*(P_kp1_k[30]*S_inv[0] + P_kp1_k[31]*S_inv[6] + P_kp1_k[32]*S_inv[12] + P_kp1_k[33]*S_inv[18] + P_kp1_k[34]*S_inv[24] + P_kp1_k[35]*S_inv[30]) + (-x_kp1_k[1] + z_k[1])*(P_kp1_k[30]*S_inv[1] + P_kp1_k[31]*S_inv[7] + P_kp1_k[32]*S_inv[13] + P_kp1_k[33]*S_inv[19] + P_kp1_k[34]*S_inv[25] + P_kp1_k[35]*S_inv[31]) + (-x_kp1_k[2] + z_k[2])*(P_kp1_k[30]*S_inv[2] + P_kp1_k[31]*S_inv[8] + P_kp1_k[32]*S_inv[14] + P_kp1_k[33]*S_inv[20] + P_kp1_k[34]*S_inv[26] + P_kp1_k[35]*S_inv[32]) + (-x_kp1_k[3] + z_k[3])*(P_kp1_k[30]*S_inv[3] + P_kp1_k[31]*S_inv[9] + P_kp1_k[32]*S_inv[15] + P_kp1_k[33]*S_inv[21] + P_kp1_k[34]*S_inv[27] + P_kp1_k[35]*S_inv[33]) + (-x_kp1_k[4] + z_k[4])*(P_kp1_k[30]*S_inv[4] + P_kp1_k[31]*S_inv[10] + P_kp1_k[32]*S_inv[16] + P_kp1_k[33]*S_inv[22] + P_kp1_k[34]*S_inv[28] + P_kp1_k[35]*S_inv[34]) + (-x_kp1_k[5] + z_k[5])*(P_kp1_k[30]*S_inv[5] + P_kp1_k[31]*S_inv[11] + P_kp1_k[32]*S_inv[17] + P_kp1_k[33]*S_inv[23] + P_kp1_k[34]*S_inv[29] + P_kp1_k[35]*S_inv[35]) + x_kp1_k[5];
}

static void simu_covariance_corrected(double *P_kp1_k, double *S_inv, double *P_kp1_kp1) {
   P_kp1_kp1[0] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[6] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[12] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[18] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[24] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[30] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[0];
   P_kp1_kp1[1] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[7] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[13] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[19] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[25] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[31] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[1];
   P_kp1_kp1[2] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[8] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[14] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[20] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[26] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[32] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[2];
   P_kp1_kp1[3] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[9] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[15] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[21] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[27] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[33] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[3];
   P_kp1_kp1[4] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[10] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[16] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[22] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[28] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[34] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[4];
   P_kp1_kp1[5] = (-P_kp1_k[0]*S_inv[1] - P_kp1_k[1]*S_inv[7] - P_kp1_k[2]*S_inv[13] - P_kp1_k[3]*S_inv[19] - P_kp1_k[4]*S_inv[25] - P_kp1_k[5]*S_inv[31])*P_kp1_k[11] + (-P_kp1_k[0]*S_inv[2] - P_kp1_k[1]*S_inv[8] - P_kp1_k[2]*S_inv[14] - P_kp1_k[3]*S_inv[20] - P_kp1_k[4]*S_inv[26] - P_kp1_k[5]*S_inv[32])*P_kp1_k[17] + (-P_kp1_k[0]*S_inv[3] - P_kp1_k[1]*S_inv[9] - P_kp1_k[2]*S_inv[15] - P_kp1_k[3]*S_inv[21] - P_kp1_k[4]*S_inv[27] - P_kp1_k[5]*S_inv[33])*P_kp1_k[23] + (-P_kp1_k[0]*S_inv[4] - P_kp1_k[1]*S_inv[10] - P_kp1_k[2]*S_inv[16] - P_kp1_k[3]*S_inv[22] - P_kp1_k[4]*S_inv[28] - P_kp1_k[5]*S_inv[34])*P_kp1_k[29] + (-P_kp1_k[0]*S_inv[5] - P_kp1_k[1]*S_inv[11] - P_kp1_k[2]*S_inv[17] - P_kp1_k[3]*S_inv[23] - P_kp1_k[4]*S_inv[29] - P_kp1_k[5]*S_inv[35])*P_kp1_k[35] + (-P_kp1_k[0]*S_inv[0] - P_kp1_k[1]*S_inv[6] - P_kp1_k[2]*S_inv[12] - P_kp1_k[3]*S_inv[18] - P_kp1_k[4]*S_inv[24] - P_kp1_k[5]*S_inv[30] + 1)*P_kp1_k[5];
   P_kp1_kp1[6] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[0] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[12] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[18] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[24] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[30] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[6];
   P_kp1_kp1[7] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[1] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[13] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[19] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[25] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[31] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[7];
   P_kp1_kp1[8] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[2] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[14] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[20] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[26] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[32] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[8];
   P_kp1_kp1[9] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[3] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[15] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[21] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[27] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[33] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[9];
   P_kp1_kp1[10] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[4] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[16] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[22] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[28] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[34] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[10];
   P_kp1_kp1[11] = (-P_kp1_k[6]*S_inv[0] - P_kp1_k[7]*S_inv[6] - P_kp1_k[8]*S_inv[12] - P_kp1_k[9]*S_inv[18] - P_kp1_k[10]*S_inv[24] - P_kp1_k[11]*S_inv[30])*P_kp1_k[5] + (-P_kp1_k[6]*S_inv[2] - P_kp1_k[7]*S_inv[8] - P_kp1_k[8]*S_inv[14] - P_kp1_k[9]*S_inv[20] - P_kp1_k[10]*S_inv[26] - P_kp1_k[11]*S_inv[32])*P_kp1_k[17] + (-P_kp1_k[6]*S_inv[3] - P_kp1_k[7]*S_inv[9] - P_kp1_k[8]*S_inv[15] - P_kp1_k[9]*S_inv[21] - P_kp1_k[10]*S_inv[27] - P_kp1_k[11]*S_inv[33])*P_kp1_k[23] + (-P_kp1_k[6]*S_inv[4] - P_kp1_k[7]*S_inv[10] - P_kp1_k[8]*S_inv[16] - P_kp1_k[9]*S_inv[22] - P_kp1_k[10]*S_inv[28] - P_kp1_k[11]*S_inv[34])*P_kp1_k[29] + (-P_kp1_k[6]*S_inv[5] - P_kp1_k[7]*S_inv[11] - P_kp1_k[8]*S_inv[17] - P_kp1_k[9]*S_inv[23] - P_kp1_k[10]*S_inv[29] - P_kp1_k[11]*S_inv[35])*P_kp1_k[35] + (-P_kp1_k[6]*S_inv[1] - P_kp1_k[7]*S_inv[7] - P_kp1_k[8]*S_inv[13] - P_kp1_k[9]*S_inv[19] - P_kp1_k[10]*S_inv[25] - P_kp1_k[11]*S_inv[31] + 1)*P_kp1_k[11];
   P_kp1_kp1[12] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[0] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[6] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[18] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[24] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[30] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[12];
   P_kp1_kp1[13] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[1] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[7] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[19] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[25] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[31] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[13];
   P_kp1_kp1[14] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[2] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[8] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[20] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[26] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[32] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[14];
   P_kp1_kp1[15] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[3] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[9] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[21] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[27] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[33] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[15];
   P_kp1_kp1[16] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[4] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[10] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[22] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[28] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[34] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[16];
   P_kp1_kp1[17] = (-P_kp1_k[12]*S_inv[0] - P_kp1_k[13]*S_inv[6] - P_kp1_k[14]*S_inv[12] - P_kp1_k[15]*S_inv[18] - P_kp1_k[16]*S_inv[24] - P_kp1_k[17]*S_inv[30])*P_kp1_k[5] + (-P_kp1_k[12]*S_inv[1] - P_kp1_k[13]*S_inv[7] - P_kp1_k[14]*S_inv[13] - P_kp1_k[15]*S_inv[19] - P_kp1_k[16]*S_inv[25] - P_kp1_k[17]*S_inv[31])*P_kp1_k[11] + (-P_kp1_k[12]*S_inv[3] - P_kp1_k[13]*S_inv[9] - P_kp1_k[14]*S_inv[15] - P_kp1_k[15]*S_inv[21] - P_kp1_k[16]*S_inv[27] - P_kp1_k[17]*S_inv[33])*P_kp1_k[23] + (-P_kp1_k[12]*S_inv[4] - P_kp1_k[13]*S_inv[10] - P_kp1_k[14]*S_inv[16] - P_kp1_k[15]*S_inv[22] - P_kp1_k[16]*S_inv[28] - P_kp1_k[17]*S_inv[34])*P_kp1_k[29] + (-P_kp1_k[12]*S_inv[5] - P_kp1_k[13]*S_inv[11] - P_kp1_k[14]*S_inv[17] - P_kp1_k[15]*S_inv[23] - P_kp1_k[16]*S_inv[29] - P_kp1_k[17]*S_inv[35])*P_kp1_k[35] + (-P_kp1_k[12]*S_inv[2] - P_kp1_k[13]*S_inv[8] - P_kp1_k[14]*S_inv[14] - P_kp1_k[15]*S_inv[20] - P_kp1_k[16]*S_inv[26] - P_kp1_k[17]*S_inv[32] + 1)*P_kp1_k[17];
   P_kp1_kp1[18] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[0] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[6] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[12] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[24] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[30] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[18];
   P_kp1_kp1[19] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[1] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[7] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[13] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[25] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[31] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[19];
   P_kp1_kp1[20] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[2] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[8] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[14] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[26] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[32] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[20];
   P_kp1_kp1[21] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[3] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[9] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[15] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[27] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[33] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[21];
   P_kp1_kp1[22] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[4] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[10] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[16] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[28] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[34] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[22];
   P_kp1_kp1[23] = (-P_kp1_k[18]*S_inv[0] - P_kp1_k[19]*S_inv[6] - P_kp1_k[20]*S_inv[12] - P_kp1_k[21]*S_inv[18] - P_kp1_k[22]*S_inv[24] - P_kp1_k[23]*S_inv[30])*P_kp1_k[5] + (-P_kp1_k[18]*S_inv[1] - P_kp1_k[19]*S_inv[7] - P_kp1_k[20]*S_inv[13] - P_kp1_k[21]*S_inv[19] - P_kp1_k[22]*S_inv[25] - P_kp1_k[23]*S_inv[31])*P_kp1_k[11] + (-P_kp1_k[18]*S_inv[2] - P_kp1_k[19]*S_inv[8] - P_kp1_k[20]*S_inv[14] - P_kp1_k[21]*S_inv[20] - P_kp1_k[22]*S_inv[26] - P_kp1_k[23]*S_inv[32])*P_kp1_k[17] + (-P_kp1_k[18]*S_inv[4] - P_kp1_k[19]*S_inv[10] - P_kp1_k[20]*S_inv[16] - P_kp1_k[21]*S_inv[22] - P_kp1_k[22]*S_inv[28] - P_kp1_k[23]*S_inv[34])*P_kp1_k[29] + (-P_kp1_k[18]*S_inv[5] - P_kp1_k[19]*S_inv[11] - P_kp1_k[20]*S_inv[17] - P_kp1_k[21]*S_inv[23] - P_kp1_k[22]*S_inv[29] - P_kp1_k[23]*S_inv[35])*P_kp1_k[35] + (-P_kp1_k[18]*S_inv[3] - P_kp1_k[19]*S_inv[9] - P_kp1_k[20]*S_inv[15] - P_kp1_k[21]*S_inv[21] - P_kp1_k[22]*S_inv[27] - P_kp1_k[23]*S_inv[33] + 1)*P_kp1_k[23];
   P_kp1_kp1[24] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[0] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[6] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[12] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[18] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[30] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[24];
   P_kp1_kp1[25] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[1] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[7] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[13] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[19] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[31] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[25];
   P_kp1_kp1[26] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[2] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[8] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[14] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[20] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[32] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[26];
   P_kp1_kp1[27] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[3] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[9] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[15] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[21] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[33] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[27];
   P_kp1_kp1[28] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[4] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[10] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[16] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[22] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[34] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[28];
   P_kp1_kp1[29] = (-P_kp1_k[24]*S_inv[0] - P_kp1_k[25]*S_inv[6] - P_kp1_k[26]*S_inv[12] - P_kp1_k[27]*S_inv[18] - P_kp1_k[28]*S_inv[24] - P_kp1_k[29]*S_inv[30])*P_kp1_k[5] + (-P_kp1_k[24]*S_inv[1] - P_kp1_k[25]*S_inv[7] - P_kp1_k[26]*S_inv[13] - P_kp1_k[27]*S_inv[19] - P_kp1_k[28]*S_inv[25] - P_kp1_k[29]*S_inv[31])*P_kp1_k[11] + (-P_kp1_k[24]*S_inv[2] - P_kp1_k[25]*S_inv[8] - P_kp1_k[26]*S_inv[14] - P_kp1_k[27]*S_inv[20] - P_kp1_k[28]*S_inv[26] - P_kp1_k[29]*S_inv[32])*P_kp1_k[17] + (-P_kp1_k[24]*S_inv[3] - P_kp1_k[25]*S_inv[9] - P_kp1_k[26]*S_inv[15] - P_kp1_k[27]*S_inv[21] - P_kp1_k[28]*S_inv[27] - P_kp1_k[29]*S_inv[33])*P_kp1_k[23] + (-P_kp1_k[24]*S_inv[5] - P_kp1_k[25]*S_inv[11] - P_kp1_k[26]*S_inv[17] - P_kp1_k[27]*S_inv[23] - P_kp1_k[28]*S_inv[29] - P_kp1_k[29]*S_inv[35])*P_kp1_k[35] + (-P_kp1_k[24]*S_inv[4] - P_kp1_k[25]*S_inv[10] - P_kp1_k[26]*S_inv[16] - P_kp1_k[27]*S_inv[22] - P_kp1_k[28]*S_inv[28] - P_kp1_k[29]*S_inv[34] + 1)*P_kp1_k[29];
   P_kp1_kp1[30] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[0] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[6] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[12] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[18] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[24] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[30];
   P_kp1_kp1[31] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[1] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[7] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[13] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[19] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[25] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[31];
   P_kp1_kp1[32] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[2] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[8] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[14] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[20] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[26] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[32];
   P_kp1_kp1[33] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[3] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[9] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[15] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[21] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[27] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[33];
   P_kp1_kp1[34] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[4] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[10] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[16] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[22] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[28] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[34];
   P_kp1_kp1[35] = (-P_kp1_k[30]*S_inv[0] - P_kp1_k[31]*S_inv[6] - P_kp1_k[32]*S_inv[12] - P_kp1_k[33]*S_inv[18] - P_kp1_k[34]*S_inv[24] - P_kp1_k[35]*S_inv[30])*P_kp1_k[5] + (-P_kp1_k[30]*S_inv[1] - P_kp1_k[31]*S_inv[7] - P_kp1_k[32]*S_inv[13] - P_kp1_k[33]*S_inv[19] - P_kp1_k[34]*S_inv[25] - P_kp1_k[35]*S_inv[31])*P_kp1_k[11] + (-P_kp1_k[30]*S_inv[2] - P_kp1_k[31]*S_inv[8] - P_kp1_k[32]*S_inv[14] - P_kp1_k[33]*S_inv[20] - P_kp1_k[34]*S_inv[26] - P_kp1_k[35]*S_inv[32])*P_kp1_k[17] + (-P_kp1_k[30]*S_inv[3] - P_kp1_k[31]*S_inv[9] - P_kp1_k[32]*S_inv[15] - P_kp1_k[33]*S_inv[21] - P_kp1_k[34]*S_inv[27] - P_kp1_k[35]*S_inv[33])*P_kp1_k[23] + (-P_kp1_k[30]*S_inv[4] - P_kp1_k[31]*S_inv[10] - P_kp1_k[32]*S_inv[16] - P_kp1_k[33]*S_inv[22] - P_kp1_k[34]*S_inv[28] - P_kp1_k[35]*S_inv[34])*P_kp1_k[29] + (-P_kp1_k[30]*S_inv[5] - P_kp1_k[31]*S_inv[11] - P_kp1_k[32]*S_inv[17] - P_kp1_k[33]*S_inv[23] - P_kp1_k[34]*S_inv[29] - P_kp1_k[35]*S_inv[35] + 1)*P_kp1_k[35];
}

double Q[36] = {
    1,0,0,0,0,0,
    0,1,0,0,0,0,
    0,0,1,0,0,0,
    0,0,0,1,0,0,
    0,0,0,0,1,0,
    0,0,0,0,0,1
};
double R[36] = {
    1,0,0,0,0,0,
    0,1,0,0,0,0,
    0,0,1,0,0,0,
    0,0,0,1,0,0,
    0,0,0,0,1,0,
    0,0,0,0,0,1
};
double x[IMU_MAX_NUMBER][6]  = {{0}};
double P[IMU_MAX_NUMBER][36] = {{0}};
double T[IMU_MAX_NUMBER]     = {-1.0};

typedef struct
{
    float a[3]; // accelerometer
    float g[3]; // gyroscope
    float b[3]; // magnetometer
    float linAcc[3]; // linear acceleration
    float timeStamp; // timestamp
} ImuData;


static void simu_compute_quaternion(int imuInd, ImuData d, double q[4]) {
    static double timestamp[IMU_MAX_NUMBER];
    double x_kp1_k[6]  = {0};
    double P_kp1_k[36] = {0};
    double z[6] = {d.a[0]-d.linAcc[0], d.a[1]-d.linAcc[1], d.a[2]-d.linAcc[2], d.b[0], d.b[1], d.b[2]};
    double y[6] = {0};
    double S[36] = {0};
    double S_inv[36] = {0};
    double K[36] = {0};
    double Ky[6] = {0};
    double I_K[36] = {0};

    if (0.0 > T[imuInd]) {
        timestamp[imuInd] = d.timeStamp;
    }
    T[imuInd] = d.timeStamp - timestamp[imuInd];
    timestamp[imuInd] = d.timeStamp;

    // Predict
    simu_state_estimate(T[imuInd],
        x[imuInd][0],x[imuInd][1],x[imuInd][2],x[imuInd][3],x[imuInd][4],x[imuInd][5],
        d.g[0],d.g[1],d.g[2], 
        x_kp1_k);
    simu_covariance_estimate(T[imuInd],
        P[imuInd],Q,
        d.g[0],d.g[1],d.g[2], 
        P_kp1_k);
    // Correct
    for (int i=0;i<6;i++) {
        y[i] = z[i] - x_kp1_k[i];
    }
    for (int i=0;i<36;i++) {
        S[i] = P_kp1_k[i] + R[i];
    }
    for (int i=0;i<6;i++) {
        for (int j=0;j<6;j++) {
            // aprox with transpose
            S_inv[i*6 + j] = S[j*6 + i];
        }
    }
    simu_state_corrected(P_kp1_k, S_inv, x_kp1_k, z, x[imuInd]);
    simu_covariance_corrected(P_kp1_k, S_inv, P[imuInd]);
}

